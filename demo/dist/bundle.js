!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var r in s)("object"==typeof exports?exports:t)[r]=s[r]}}(window,function(){return function(t){var e={};function s(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=10)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(9),i=s(8),o=s(7),n=s(6);var a;!function(t){t.BINARY="BINARY",t.RELU="RELU",t.SIGMOIDAL="SIGMOIDAL",t.HYPERBOLIC_TANGENT="HYPERBOLIC_TANGENT"}(a=e.ActivationFunctionType||(e.ActivationFunctionType={}));const c={[a.BINARY]:r.Binary,[a.RELU]:n.ReLU,[a.SIGMOIDAL]:o.Sigmoidal,[a.HYPERBOLIC_TANGENT]:i.HyperbolicTangent};class h{constructor(t=a.BINARY){this.default=t,this.setCallback(),this.setCallbackPrime()}static init(t){return new h(t)}activation(t){return this.callback(t)}prime(t){return this.callbackPrime(t)}setCallback(){this.callback=c[this.default].activation}setCallbackPrime(){this.callbackPrime=c[this.default].prime}}e.ActivationFunction=h},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(0);e.SynapticProcessor=class{constructor(t,e=.3){this.error=0,this.activationFunction=r.ActivationFunction.init(t),this.setLearningFactor(e)}output(){return this.activationFunction.activation(this.synapse)}recalculateWeights(t){const e=this.outputExpected-this.output();this.delta=this.learningRate*e;for(let e=0;e<t.length;e++)t[e]+=this.data[e]*this.delta}calculateSynapses(t,e){this.synapse=0;for(let e=0;e<t.length;e++)this.synapse+=this.data[e]*t[e];return this.synapse+=e,this}calculateError(){return this.error=this.outputExpected-this.output(),this}setData(t){return this.data=t.slice(),this}setOutputExpected(t){return this.outputExpected=t,this}setLearningFactor(t){return this.learningRate=t,this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(1);e.Perceptron=class{constructor(t,e=(()=>{})){this.weights=null,this.funcBack=e,this.synapticProcessor=new r.SynapticProcessor(t),this.dataStack=[]}addData(t,e){return this.dataStack.push([t,e]),this}learn(){this.weights||this.assignWeights();let t=0;const e=()=>{let s=!1;for(let t=0;t<this.dataStack.length;t++)this.synapticProcessor.setData(this.dataStack[t][0]).setOutputExpected(this.dataStack[t][1]).calculateSynapses(this.weights,this.threshold).calculateError(),0!==this.synapticProcessor.error&&(this.synapticProcessor.recalculateWeights(this.weights),this.threshold+=this.synapticProcessor.delta,s=!0,this.funcBack());if(s){if(++t>=8e3)throw t=0,Error("Maximum error limit reached");return e()}t=0};return e(),this}process(t){return this.synapticProcessor.setData(t).calculateSynapses(this.weights,this.threshold).output()}setWeights(t){return this.weights=t,this}createWeight(){const t=-.5,e=.49-t;let s=0;for(;!s;)s=parseFloat((Math.random()*e+t).toFixed(4));return s}assignWeights(t=null){t||(t=this.dataStack[0][0].length);const e=new Float64Array(t);for(let s=0;s<t;s++)e[s]=this.createWeight();return this.setWeights(e),this.threshold=this.createWeight(),this.funcBack(),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(0),i=s(2);e.Neuron=class extends i.Perceptron{constructor(t=r.ActivationFunctionType.SIGMOIDAL){super(t),this.error=0,this.synapse=0,this.outputNeurons=[],this.inputNeurons=[]}learn(t){return t&&(this.synapticProcessor.data=t),this.currentData=this.synapticProcessor.data,this.weights||(this.assignWeights(this.currentData.length),this.setBeforeWeights(this.weights.slice())),this.synapticProcessor.calculateSynapses(this.weights,this.threshold),this.synapse=this.synapticProcessor.synapse,this}backpropagation(){for(let t=0;t<this.inputNeurons.length;t++)this.inputNeurons[t].calculateHiddenError(t);this.inputNeurons.length>0&&this.inputNeurons[0].backpropagation()}recalculateWeights(){const t=this.synapticProcessor.learningRate*this.error;let e=0;for(let s=0;s<this.weights.length;s++)0!==this.currentData[s]&&(e=.77*(this.weights[s]-this.beforeWeights[s]),this.beforeWeights[s]=this.weights[s],this.weights[s]+=this.currentData[s]*t+e);this.threshold+=t}output(){return this.synapticProcessor.activationFunction.activation(this.synapse)}process(){return this.synapticProcessor.calculateSynapses(this.weights,this.threshold),this.synapse=this.synapticProcessor.synapse,this.output()}calculateErrorOfOutput(t){const e=t-this.output();this.calculateErrorDerivated(e)}calculateHiddenError(t){let e=0;for(let s=0;s<this.outputNeurons.length;s++){const r=this.outputNeurons[s];e+=r.weights[t]*r.error}return this.calculateErrorDerivated(e),this}calculateErrorDerivated(t){return this.error=t*this.prime(),this}prime(){return this.synapticProcessor.activationFunction.prime(this.synapse)}setBeforeWeights(t){return this.beforeWeights=t,this}setThreshold(t){return this.threshold=t,this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(0),i=s(3),o=s(1);e.Layer=class{constructor(t=r.ActivationFunctionType.SIGMOIDAL,e){this.layers=[],this.activationFunction=t,this.synapticProcessor=new o.SynapticProcessor(this.activationFunction,e)}add(t){const e=this.create(t),s=this.layers.push(e)-1,r=this.layers[s-1];return void 0===r?this:(e.forEach(t=>{t.inputNeurons=r}),r.forEach(t=>{t.outputNeurons=e}),this)}forEach(t){for(let e=0;e<this.layers.length;e++)t(this.layers[e],e)}get(t){return this.layers[t]}getLast(){return this.get(this.layers.length-1)}create(t){const e=[];for(let s=0;s<t;s++)e[s]=new i.Neuron(this.activationFunction),e[s].synapticProcessor=this.synapticProcessor;return e}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(0),i=s(4);e.Backpropagation=class{constructor(t={epochs:1e3,activationFunction:r.ActivationFunctionType.SIGMOIDAL,learningRate:.3,verbose:!1}){this.error=0,this.activationFunction=t.activationFunction,this.layers=new i.Layer(this.activationFunction,t.learningRate),this.epochs=t.epochs,this.verbose=t.verbose,this.history={loss:[]}}learn(t){this.datasetInputToFloatArray(t),this.runEpoch(t);let e=1;for(;e<=this.epochs;)this.history.loss.push(this.error),e++,this.verbose&&e%1e3==0&&console.log(this.error,e),this.runEpoch(t);return this}process(t){let e=[];return t=new Float64Array(t),this.verbose&&console.log(t),this.layers.forEach(s=>{e.length>0&&(t=new Float64Array(e),e=[]),this.layers.synapticProcessor.setData(t);for(let t=0;t<s.length;t++){const r=s[t];e[t]=r.process()}}),this.verbose&&console.log(e),e}addLayer(t){return this.layers.add(t),this}importModel(t){return t.layers.forEach(t=>{this.addLayer(t)}),t.weights.forEach((e,s)=>{this.layers.get(s).forEach((r,i)=>{r.setWeights(new Float64Array(e[i])).setBeforeWeights(r.weights.slice()).setThreshold(t.thresholds[s][i])})}),this}exportModel(){let t={layers:[],thresholds:[],weights:[]};return this.layers.forEach(e=>{t.layers.push(e.length);const s=t.thresholds.push([]),r=t.weights.push([]);let i=t.thresholds[s-1],o=t.weights[r-1];e.forEach(t=>{o.push(Array.from(t.weights)),i.push(t.threshold)})}),t}datasetInputToFloatArray(t){for(let e=0;e<t.length;e++){const s=t[e];s.input=new Float64Array(s.input)}}runEpoch(t){for(let e=0;e<t.length;e++){const s=t[e];this.forwardpropagation(s),this.backpropagation(s.output),this.layers.forEach(t=>{for(let e=0;e<t.length;e++)t[e].recalculateWeights()})}}forwardpropagation({input:t}){let e=[],s=new Float64Array(t);return this.layers.forEach(t=>{e.length>0&&(s=new Float64Array(e),e=[]),this.layers.synapticProcessor.setData(s);for(let s=0;s<t.length;s++){const r=t[s];e[s]=r.learn().output()}}),this}backpropagation(t){const e=this.layers.getLast();let s=0;for(let r=0;r<e.length;r++){const i=e[r];i.calculateErrorOfOutput(t),i.backpropagation(),s+=i.error*i.error}this.error=s/2}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.activation=function(t){return t>0?t:0},t.prime=function(t){return t}}(e.ReLU||(e.ReLU={}))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.activation=function(t){return 1/(1+Math.E**-t)},t.prime=function(t){const e=Math.E**t;return e/(e+1)**2}}(e.Sigmoidal||(e.Sigmoidal={}))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){function e(t){return Math.tanh(t)}t.activation=e,t.prime=function(t){const s=e(t);return 1-s*s}}(e.HyperbolicTangent||(e.HyperbolicTangent={}))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.activation=function(t){return t>=0?1:0}}(e.Binary||(e.Binary={}))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(2);e.Perceptron=r.Perceptron;const i=s(5);e.Backpropagation=i.Backpropagation}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vLi9zcmMvYWN0aXZhdGlvbi1mdW5jdGlvbnMvYWN0aXZhdGlvbi1mdW5jdGlvbi50cyIsIndlYnBhY2s6Ly8vLi9zcmMvc3luYXB0aWMtcHJvY2Vzc29yLnRzIiwid2VicGFjazovLy8uL3NyYy9wZXJjZXB0cm9uLnRzIiwid2VicGFjazovLy8uL3NyYy9uZXVyb24udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2xheWVyLnRzIiwid2VicGFjazovLy8uL3NyYy9iYWNrcHJvcGFnYXRpb24udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FjdGl2YXRpb24tZnVuY3Rpb25zL3JlbHUuZnVuY3Rpb24udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FjdGl2YXRpb24tZnVuY3Rpb25zL3NpZ21vaWRhbC5mdW5jdGlvbi50cyIsIndlYnBhY2s6Ly8vLi9zcmMvYWN0aXZhdGlvbi1mdW5jdGlvbnMvaHlwZXJib2xpYy10YW5nZW50LmZ1bmN0aW9uLnRzIiwid2VicGFjazovLy8uL3NyYy9hY3RpdmF0aW9uLWZ1bmN0aW9ucy9iaW5hcnkuZnVuY3Rpb24udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsImEiLCJpIiwid2luZG93IiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJiaW5hcnlfZnVuY3Rpb25fMSIsImh5cGVyYm9saWNfdGFuZ2VudF9mdW5jdGlvbl8xIiwic2lnbW9pZGFsX2Z1bmN0aW9uXzEiLCJyZWx1X2Z1bmN0aW9uXzEiLCJBY3RpdmF0aW9uRnVuY3Rpb25UeXBlIiwiY2FsbGJhY2siLCJbb2JqZWN0IE9iamVjdF0iLCJCSU5BUlkiLCJCaW5hcnkiLCJSRUxVIiwiUmVMVSIsIlNJR01PSURBTCIsIlNpZ21vaWRhbCIsIkhZUEVSQk9MSUNfVEFOR0VOVCIsIkh5cGVyYm9saWNUYW5nZW50IiwiQWN0aXZhdGlvbkZ1bmN0aW9uIiwiZnVuY3Rpb25OYW1lIiwidGhpcyIsImRlZmF1bHQiLCJzZXRDYWxsYmFjayIsInNldENhbGxiYWNrUHJpbWUiLCJzeW5hcHNlIiwiY2FsbGJhY2tQcmltZSIsImFjdGl2YXRpb24iLCJwcmltZSIsImFjdGl2YXRpb25fZnVuY3Rpb25fMSIsIlN5bmFwdGljUHJvY2Vzc29yIiwiYWN0aXZhdGlvbkZ1bmN0aW9uIiwibGVhcm5pbmdSYXRlIiwiZXJyb3IiLCJpbml0Iiwic2V0TGVhcm5pbmdGYWN0b3IiLCJ3ZWlnaHRzIiwib3V0cHV0RXhwZWN0ZWQiLCJvdXRwdXQiLCJkZWx0YSIsImxlbmd0aCIsImRhdGEiLCJ0aHJlc2hvbGQiLCJzbGljZSIsImV4cGVjdGVkT3V0cHV0IiwibGVhcm5pbmdGYWN0b3IiLCJzeW5hcHRpY19wcm9jZXNzb3JfMSIsIlBlcmNlcHRyb24iLCJmdW5jQmFjayIsInN5bmFwdGljUHJvY2Vzc29yIiwiZGF0YVN0YWNrIiwicHVzaCIsImFzc2lnbldlaWdodHMiLCJjb3VudGVyRXJyb3JzIiwicnVuRXBvY2hzIiwiaGFzRXJyb3IiLCJzZXREYXRhIiwic2V0T3V0cHV0RXhwZWN0ZWQiLCJjYWxjdWxhdGVTeW5hcHNlcyIsImNhbGN1bGF0ZUVycm9yIiwicmVjYWxjdWxhdGVXZWlnaHRzIiwiRXJyb3IiLCJyYW5nZVdlaWdodCIsInJhbmdlRGlmZiIsIndlaWdodCIsInBhcnNlRmxvYXQiLCJNYXRoIiwicmFuZG9tIiwidG9GaXhlZCIsImRhdGFTaXplIiwiRmxvYXQ2NEFycmF5IiwiY3JlYXRlV2VpZ2h0Iiwic2V0V2VpZ2h0cyIsInBlcmNlcHRyb25fMSIsIk5ldXJvbiIsInN1cGVyIiwib3V0cHV0TmV1cm9ucyIsImlucHV0TmV1cm9ucyIsImN1cnJlbnREYXRhIiwic2V0QmVmb3JlV2VpZ2h0cyIsImluZGV4IiwiY2FsY3VsYXRlSGlkZGVuRXJyb3IiLCJiYWNrcHJvcGFnYXRpb24iLCJkZWx0YVdlaWdodHMiLCJiZWZvcmVXZWlnaHRzIiwiY2FsY3VsYXRlRXJyb3JEZXJpdmF0ZWQiLCJuZXVyb25JbmRleCIsInN1bUVycm9yIiwibmV1cm9uIiwiZmFjdG9yRGVsdGEiLCJuZXVyb25fMSIsIkxheWVyIiwibGF5ZXJzIiwibnVtYmVyTmV1cm9ucyIsImxheWVyIiwiY3JlYXRlIiwiaW5kZXhOZXdMYXllciIsImJlZm9yZUxheWVyIiwidW5kZWZpbmVkIiwiZm9yRWFjaCIsImlkeCIsImxheWVyXzEiLCJCYWNrcHJvcGFnYXRpb24iLCJjb25maWciLCJlcG9jaHMiLCJ2ZXJib3NlIiwiaGlzdG9yeSIsImxvc3MiLCJkYXRhc2V0IiwiZGF0YXNldElucHV0VG9GbG9hdEFycmF5IiwicnVuRXBvY2giLCJjb3VudGVyRXBvY2hzIiwiY29uc29sZSIsImxvZyIsIm91dHB1dHMiLCJwcm9jZXNzIiwiYWRkIiwibW9kZWwiLCJhZGRMYXllciIsImxheWVyV2VpZ2h0cyIsInNldFRocmVzaG9sZCIsInRocmVzaG9sZHMiLCJpbmRleExheWVyVGhyZXNob2xkcyIsImluZGV4TGF5ZXJXZWlnaHRzIiwibGF5ZXJUaHJlc2hvbGRzIiwiQXJyYXkiLCJmcm9tIiwiaW5wdXQiLCJkYXRhSWR4IiwiZm9yd2FyZHByb3BhZ2F0aW9uIiwibmV1cm9uSWR4IiwibGVhcm4iLCJsYXN0TGF5ZXIiLCJnZXRMYXN0Iiwic3VtRXJyb3JzIiwiY2FsY3VsYXRl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QixTQUEyQkYsR0FDdkIsT0FBT0EsR0FBVyxFQUFJLEVBQUksR0FGbEMsQ0FBaUJ2RCxFQUFBMEMsU0FBQTFDLEVBQUEwQywyRkNBakIsTUFBQTZELEVBQUEvRixFQUFBLEdBR1NSLEVBQUE2RSxXQUhBMEIsRUFBQTFCLFdBQ1QsTUFBQTRGLEVBQUFqSyxFQUFBLEdBRXFCUixFQUFBb0ksZ0JBRlpxQyxFQUFBckMiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIHtcblx0XHR2YXIgYSA9IGZhY3RvcnkoKTtcblx0XHRmb3IodmFyIGkgaW4gYSkgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyA/IGV4cG9ydHMgOiByb290KVtpXSA9IGFbaV07XG5cdH1cbn0pKHdpbmRvdywgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxMCk7XG4iLCJpbXBvcnQgeyBCaW5hcnkgfSBmcm9tICcuL2JpbmFyeS5mdW5jdGlvbic7XG5pbXBvcnQgeyBIeXBlcmJvbGljVGFuZ2VudCB9IGZyb20gJy4vaHlwZXJib2xpYy10YW5nZW50LmZ1bmN0aW9uJztcbmltcG9ydCB7IFNpZ21vaWRhbCB9IGZyb20gJy4vc2lnbW9pZGFsLmZ1bmN0aW9uJztcbmltcG9ydCB7IFJlTFUgfSBmcm9tICcuL3JlbHUuZnVuY3Rpb24nO1xuXG5leHBvcnQgZW51bSBBY3RpdmF0aW9uRnVuY3Rpb25UeXBlIHtcbiAgICBCSU5BUlkgPSAnQklOQVJZJyxcbiAgICBSRUxVID0gJ1JFTFUnLFxuICAgIFNJR01PSURBTCA9ICdTSUdNT0lEQUwnLFxuICAgIEhZUEVSQk9MSUNfVEFOR0VOVCA9ICdIWVBFUkJPTElDX1RBTkdFTlQnXG59XG5cbmNvbnN0IGNhbGxiYWNrID0ge1xuICAgIFtBY3RpdmF0aW9uRnVuY3Rpb25UeXBlLkJJTkFSWV06IEJpbmFyeSxcbiAgICBbQWN0aXZhdGlvbkZ1bmN0aW9uVHlwZS5SRUxVXTogUmVMVSxcbiAgICBbQWN0aXZhdGlvbkZ1bmN0aW9uVHlwZS5TSUdNT0lEQUxdOiBTaWdtb2lkYWwsXG4gICAgW0FjdGl2YXRpb25GdW5jdGlvblR5cGUuSFlQRVJCT0xJQ19UQU5HRU5UXTogSHlwZXJib2xpY1RhbmdlbnRcbn07XG5cbmV4cG9ydCBjbGFzcyBBY3RpdmF0aW9uRnVuY3Rpb24ge1xuICAgIHByb3RlY3RlZCBkZWZhdWx0OiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBjYWxsYmFjazogRnVuY3Rpb247XG4gICAgcHJpdmF0ZSBjYWxsYmFja1ByaW1lOiBGdW5jdGlvbjtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBmdW5jdGlvbk5hbWU6IEFjdGl2YXRpb25GdW5jdGlvblR5cGUgPSBBY3RpdmF0aW9uRnVuY3Rpb25UeXBlLkJJTkFSWVxuICAgICkge1xuICAgICAgICB0aGlzLmRlZmF1bHQgPSBmdW5jdGlvbk5hbWU7XG4gICAgICAgIHRoaXMuc2V0Q2FsbGJhY2soKTtcbiAgICAgICAgdGhpcy5zZXRDYWxsYmFja1ByaW1lKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmdW5jdGlvbk5hbWVcbiAgICAgKiBAcmV0dXJuc1xuICAgICAqL1xuICAgIHN0YXRpYyBpbml0KGZ1bmN0aW9uTmFtZTogQWN0aXZhdGlvbkZ1bmN0aW9uVHlwZSkge1xuICAgICAgICByZXR1cm4gbmV3IEFjdGl2YXRpb25GdW5jdGlvbihmdW5jdGlvbk5hbWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzeW5hcHNlXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBhY3RpdmF0aW9uKHN5bmFwc2U6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxsYmFjayhzeW5hcHNlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gc3luYXBzZVxuICAgICAqIEByZXR1cm5zXG4gICAgICovXG4gICAgcHJpbWUoc3luYXBzZTogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbGxiYWNrUHJpbWUoc3luYXBzZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRDYWxsYmFjaygpIHtcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrW3RoaXMuZGVmYXVsdF0uYWN0aXZhdGlvbjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldENhbGxiYWNrUHJpbWUoKSB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tQcmltZSA9IGNhbGxiYWNrW3RoaXMuZGVmYXVsdF0ucHJpbWU7XG4gICAgfVxufVxuIiwiaW1wb3J0IHtcbiAgICBBY3RpdmF0aW9uRnVuY3Rpb24sXG4gICAgQWN0aXZhdGlvbkZ1bmN0aW9uVHlwZVxufSBmcm9tICcuL2FjdGl2YXRpb24tZnVuY3Rpb25zL2FjdGl2YXRpb24tZnVuY3Rpb24nO1xuXG5leHBvcnQgY2xhc3MgU3luYXB0aWNQcm9jZXNzb3Ige1xuICAgIGFjdGl2YXRpb25GdW5jdGlvbjogQWN0aXZhdGlvbkZ1bmN0aW9uO1xuICAgIGVycm9yOiBudW1iZXI7XG4gICAgc3luYXBzZTogbnVtYmVyO1xuICAgIGRhdGE6IEZsb2F0NjRBcnJheTtcbiAgICBsZWFybmluZ1JhdGU6IG51bWJlcjtcbiAgICBkZWx0YTogbnVtYmVyO1xuICAgIG91dHB1dEV4cGVjdGVkOiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgYWN0aXZhdGlvbkZ1bmN0aW9uOiBBY3RpdmF0aW9uRnVuY3Rpb25UeXBlLFxuICAgICAgICBsZWFybmluZ1JhdGU6IG51bWJlciA9IDAuM1xuICAgICkge1xuICAgICAgICB0aGlzLmVycm9yID0gMDtcbiAgICAgICAgdGhpcy5hY3RpdmF0aW9uRnVuY3Rpb24gPSBBY3RpdmF0aW9uRnVuY3Rpb24uaW5pdChhY3RpdmF0aW9uRnVuY3Rpb24pO1xuICAgICAgICB0aGlzLnNldExlYXJuaW5nRmFjdG9yKGxlYXJuaW5nUmF0ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBvdXRwdXQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZhdGlvbkZ1bmN0aW9uLmFjdGl2YXRpb24odGhpcy5zeW5hcHNlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0Zsb2F0NjRBcnJheX0gd2VpZ2h0c1xuICAgICAqL1xuICAgIHJlY2FsY3VsYXRlV2VpZ2h0cyh3ZWlnaHRzOiBGbG9hdDY0QXJyYXkpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSB0aGlzLm91dHB1dEV4cGVjdGVkIC0gdGhpcy5vdXRwdXQoKTtcbiAgICAgICAgdGhpcy5kZWx0YSA9IHRoaXMubGVhcm5pbmdSYXRlICogZXJyb3I7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3ZWlnaHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB3ZWlnaHRzW2ldICs9IHRoaXMuZGF0YVtpXSAqIHRoaXMuZGVsdGE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0Zsb2F0NjRBcnJheX0gd2VpZ2h0c1xuICAgICAqIEByZXR1cm5zXG4gICAgICovXG4gICAgY2FsY3VsYXRlU3luYXBzZXMod2VpZ2h0czogRmxvYXQ2NEFycmF5LCB0aHJlc2hvbGQpIHtcbiAgICAgICAgdGhpcy5zeW5hcHNlID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdlaWdodHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuc3luYXBzZSArPSB0aGlzLmRhdGFbaV0gKiB3ZWlnaHRzW2ldO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zeW5hcHNlICs9IHRocmVzaG9sZDtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBjYWxjdWxhdGVFcnJvcigpIHtcbiAgICAgICAgdGhpcy5lcnJvciA9IHRoaXMub3V0cHV0RXhwZWN0ZWQgLSB0aGlzLm91dHB1dCgpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHNldERhdGEoZGF0YTogRmxvYXQ2NEFycmF5KSB7XG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGEuc2xpY2UoKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBzZXRPdXRwdXRFeHBlY3RlZChleHBlY3RlZE91dHB1dCkge1xuICAgICAgICB0aGlzLm91dHB1dEV4cGVjdGVkID0gZXhwZWN0ZWRPdXRwdXQ7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgc2V0TGVhcm5pbmdGYWN0b3IobGVhcm5pbmdGYWN0b3IpIHtcbiAgICAgICAgdGhpcy5sZWFybmluZ1JhdGUgPSBsZWFybmluZ0ZhY3RvcjtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBBY3RpdmF0aW9uRnVuY3Rpb25UeXBlIH0gZnJvbSAnLi9hY3RpdmF0aW9uLWZ1bmN0aW9ucy9hY3RpdmF0aW9uLWZ1bmN0aW9uJztcbmltcG9ydCB7IFN5bmFwdGljUHJvY2Vzc29yIH0gZnJvbSAnLi9zeW5hcHRpYy1wcm9jZXNzb3InO1xuXG5leHBvcnQgY2xhc3MgUGVyY2VwdHJvbiB7XG4gICAgZGF0YVN0YWNrOiBhbnlbXTtcbiAgICB3ZWlnaHRzOiBGbG9hdDY0QXJyYXk7XG4gICAgdGhyZXNob2xkOiBudW1iZXI7XG4gICAgc3luYXB0aWNQcm9jZXNzb3I6IFN5bmFwdGljUHJvY2Vzc29yO1xuXG4gICAgZnVuY0JhY2s6ICgpID0+IHZvaWQ7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgYWN0aXZhdGlvbkZ1bmN0aW9uPzogQWN0aXZhdGlvbkZ1bmN0aW9uVHlwZSxcbiAgICAgICAgY2FsbGJhY2sgPSAoKSA9PiB7fVxuICAgICkge1xuICAgICAgICB0aGlzLndlaWdodHMgPSBudWxsO1xuICAgICAgICB0aGlzLmZ1bmNCYWNrID0gY2FsbGJhY2s7XG5cbiAgICAgICAgdGhpcy5zeW5hcHRpY1Byb2Nlc3NvciA9IG5ldyBTeW5hcHRpY1Byb2Nlc3NvcihhY3RpdmF0aW9uRnVuY3Rpb24pO1xuICAgICAgICB0aGlzLmRhdGFTdGFjayA9IFtdO1xuICAgIH1cblxuICAgIGFkZERhdGEoZGF0YTogRmxvYXQ2NEFycmF5LCBvdXRwdXQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmRhdGFTdGFjay5wdXNoKFtkYXRhLCBvdXRwdXRdKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBsZWFybigpIHtcbiAgICAgICAgaWYgKCF0aGlzLndlaWdodHMpIHtcbiAgICAgICAgICAgIHRoaXMuYXNzaWduV2VpZ2h0cygpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgTElNSVRfRVJST1JTOiBudW1iZXIgPSA4MDAwO1xuICAgICAgICBsZXQgY291bnRlckVycm9ycyA9IDA7XG5cbiAgICAgICAgY29uc3QgcnVuRXBvY2hzID0gKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGhhc0Vycm9yID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kYXRhU3RhY2subGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN5bmFwdGljUHJvY2Vzc29yXG4gICAgICAgICAgICAgICAgICAgIC5zZXREYXRhKHRoaXMuZGF0YVN0YWNrW2ldWzBdKVxuICAgICAgICAgICAgICAgICAgICAuc2V0T3V0cHV0RXhwZWN0ZWQodGhpcy5kYXRhU3RhY2tbaV1bMV0pXG4gICAgICAgICAgICAgICAgICAgIC5jYWxjdWxhdGVTeW5hcHNlcyh0aGlzLndlaWdodHMsIHRoaXMudGhyZXNob2xkKVxuICAgICAgICAgICAgICAgICAgICAuY2FsY3VsYXRlRXJyb3IoKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN5bmFwdGljUHJvY2Vzc29yLmVycm9yICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3luYXB0aWNQcm9jZXNzb3IucmVjYWxjdWxhdGVXZWlnaHRzKHRoaXMud2VpZ2h0cyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGhyZXNob2xkICs9IHRoaXMuc3luYXB0aWNQcm9jZXNzb3IuZGVsdGE7XG5cbiAgICAgICAgICAgICAgICAgICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZ1bmNCYWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaGFzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb3VudGVyRXJyb3JzKys7XG5cbiAgICAgICAgICAgICAgICBpZiAoY291bnRlckVycm9ycyA+PSBMSU1JVF9FUlJPUlMpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnRlckVycm9ycyA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ01heGltdW0gZXJyb3IgbGltaXQgcmVhY2hlZCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBydW5FcG9jaHMoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY291bnRlckVycm9ycyA9IDA7XG4gICAgICAgIH07XG5cbiAgICAgICAgcnVuRXBvY2hzKCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHJvY2VzcyhkYXRhOiBGbG9hdDY0QXJyYXkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3luYXB0aWNQcm9jZXNzb3JcbiAgICAgICAgICAgIC5zZXREYXRhKGRhdGEpXG4gICAgICAgICAgICAuY2FsY3VsYXRlU3luYXBzZXModGhpcy53ZWlnaHRzLCB0aGlzLnRocmVzaG9sZClcbiAgICAgICAgICAgIC5vdXRwdXQoKTtcbiAgICB9XG5cbiAgICBzZXRXZWlnaHRzKHdlaWdodHM6IEZsb2F0NjRBcnJheSkge1xuICAgICAgICB0aGlzLndlaWdodHMgPSB3ZWlnaHRzO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBjcmVhdGVXZWlnaHQoKSB7XG4gICAgICAgIGNvbnN0IHJhbmdlV2VpZ2h0ID0geyBNSU46IC0wLjUsIE1BWDogMC40OSB9O1xuICAgICAgICBjb25zdCByYW5nZURpZmYgPSByYW5nZVdlaWdodC5NQVggLSByYW5nZVdlaWdodC5NSU47XG4gICAgICAgIGxldCB3ZWlnaHQgPSAwO1xuXG4gICAgICAgIHdoaWxlICghd2VpZ2h0KSB7XG4gICAgICAgICAgICB3ZWlnaHQgPSBwYXJzZUZsb2F0KFxuICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpICogcmFuZ2VEaWZmICsgcmFuZ2VXZWlnaHQuTUlOKS50b0ZpeGVkKDQpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHdlaWdodDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXNzaWduV2VpZ2h0cyhkYXRhU2l6ZTogbnVtYmVyID0gbnVsbCkge1xuICAgICAgICBpZiAoIWRhdGFTaXplKSB7XG4gICAgICAgICAgICBkYXRhU2l6ZSA9IHRoaXMuZGF0YVN0YWNrWzBdWzBdLmxlbmd0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdlaWdodHMgPSBuZXcgRmxvYXQ2NEFycmF5KGRhdGFTaXplKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFTaXplOyBpKyspIHtcbiAgICAgICAgICAgIHdlaWdodHNbaV0gPSB0aGlzLmNyZWF0ZVdlaWdodCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRXZWlnaHRzKHdlaWdodHMpO1xuICAgICAgICB0aGlzLnRocmVzaG9sZCA9IHRoaXMuY3JlYXRlV2VpZ2h0KCk7XG5cbiAgICAgICAgdGhpcy5mdW5jQmFjaygpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEFjdGl2YXRpb25GdW5jdGlvblR5cGUgfSBmcm9tICcuL2FjdGl2YXRpb24tZnVuY3Rpb25zL2FjdGl2YXRpb24tZnVuY3Rpb24nO1xuaW1wb3J0IHsgUGVyY2VwdHJvbiB9IGZyb20gJy4vcGVyY2VwdHJvbic7XG5cbmV4cG9ydCBjbGFzcyBOZXVyb24gZXh0ZW5kcyBQZXJjZXB0cm9uIHtcbiAgICBiZWZvcmVXZWlnaHRzOiBGbG9hdDY0QXJyYXk7XG4gICAgZXJyb3I6IG51bWJlcjtcbiAgICBpbnB1dE5ldXJvbnM6IE5ldXJvbltdO1xuICAgIG91dHB1dE5ldXJvbnM6IE5ldXJvbltdO1xuICAgIHN5bmFwc2U6IG51bWJlcjtcbiAgICBjdXJyZW50RGF0YTogRmxvYXQ2NEFycmF5O1xuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnV0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgYWN0aXZhdGlvbkZ1bmN0aW9uOiBBY3RpdmF0aW9uRnVuY3Rpb25UeXBlID0gQWN0aXZhdGlvbkZ1bmN0aW9uVHlwZS5TSUdNT0lEQUxcbiAgICApIHtcbiAgICAgICAgc3VwZXIoYWN0aXZhdGlvbkZ1bmN0aW9uKTtcblxuICAgICAgICB0aGlzLmVycm9yID0gMDtcbiAgICAgICAgdGhpcy5zeW5hcHNlID0gMDtcbiAgICAgICAgdGhpcy5vdXRwdXROZXVyb25zID0gW107XG4gICAgICAgIHRoaXMuaW5wdXROZXVyb25zID0gW107XG4gICAgfVxuXG4gICAgbGVhcm4oY3VycmVudERhdGE/OiBGbG9hdDY0QXJyYXkpIHtcbiAgICAgICAgaWYgKGN1cnJlbnREYXRhKSB7XG4gICAgICAgICAgICB0aGlzLnN5bmFwdGljUHJvY2Vzc29yLmRhdGEgPSBjdXJyZW50RGF0YTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5jdXJyZW50RGF0YSA9IHRoaXMuc3luYXB0aWNQcm9jZXNzb3IuZGF0YTtcblxuICAgICAgICBpZiAoIXRoaXMud2VpZ2h0cykge1xuICAgICAgICAgICAgdGhpcy5hc3NpZ25XZWlnaHRzKHRoaXMuY3VycmVudERhdGEubGVuZ3RoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0QmVmb3JlV2VpZ2h0cyh0aGlzLndlaWdodHMuc2xpY2UoKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnN5bmFwdGljUHJvY2Vzc29yLmNhbGN1bGF0ZVN5bmFwc2VzKHRoaXMud2VpZ2h0cywgdGhpcy50aHJlc2hvbGQpO1xuICAgICAgICB0aGlzLnN5bmFwc2UgPSB0aGlzLnN5bmFwdGljUHJvY2Vzc29yLnN5bmFwc2U7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXJyb3Igb24gaGlkZGVuIGxheWVyc1xuICAgICAqL1xuICAgIGJhY2twcm9wYWdhdGlvbigpIHtcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuaW5wdXROZXVyb25zLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgdGhpcy5pbnB1dE5ldXJvbnNbaW5kZXhdLmNhbGN1bGF0ZUhpZGRlbkVycm9yKGluZGV4KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlucHV0TmV1cm9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0TmV1cm9uc1swXS5iYWNrcHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlY2FsY3VsYXRlV2VpZ2h0cygpIHtcbiAgICAgICAgY29uc3QgZGVsdGEgPSB0aGlzLnN5bmFwdGljUHJvY2Vzc29yLmxlYXJuaW5nUmF0ZSAqIHRoaXMuZXJyb3I7XG4gICAgICAgIGNvbnN0IG1vbWVudHVtRmFjdG9yID0gMC43NztcbiAgICAgICAgbGV0IGRlbHRhV2VpZ2h0czogbnVtYmVyID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMud2VpZ2h0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudERhdGFbaV0gPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGVsdGFXZWlnaHRzID1cbiAgICAgICAgICAgICAgICBtb21lbnR1bUZhY3RvciAqICh0aGlzLndlaWdodHNbaV0gLSB0aGlzLmJlZm9yZVdlaWdodHNbaV0pO1xuXG4gICAgICAgICAgICB0aGlzLmJlZm9yZVdlaWdodHNbaV0gPSB0aGlzLndlaWdodHNbaV07XG4gICAgICAgICAgICB0aGlzLndlaWdodHNbaV0gKz0gdGhpcy5jdXJyZW50RGF0YVtpXSAqIGRlbHRhICsgZGVsdGFXZWlnaHRzO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50aHJlc2hvbGQgKz0gZGVsdGE7XG4gICAgfVxuXG4gICAgb3V0cHV0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnN5bmFwdGljUHJvY2Vzc29yLmFjdGl2YXRpb25GdW5jdGlvbi5hY3RpdmF0aW9uKFxuICAgICAgICAgICAgdGhpcy5zeW5hcHNlXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJvY2VzcygpIHtcbiAgICAgICAgdGhpcy5zeW5hcHRpY1Byb2Nlc3Nvci5jYWxjdWxhdGVTeW5hcHNlcyh0aGlzLndlaWdodHMsIHRoaXMudGhyZXNob2xkKTtcbiAgICAgICAgdGhpcy5zeW5hcHNlID0gdGhpcy5zeW5hcHRpY1Byb2Nlc3Nvci5zeW5hcHNlO1xuXG4gICAgICAgIHJldHVybiB0aGlzLm91dHB1dCgpO1xuICAgIH1cblxuICAgIGNhbGN1bGF0ZUVycm9yT2ZPdXRwdXQob3V0cHV0RXhwZWN0ZWQpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBvdXRwdXRFeHBlY3RlZCAtIHRoaXMub3V0cHV0KCk7XG5cbiAgICAgICAgdGhpcy5jYWxjdWxhdGVFcnJvckRlcml2YXRlZChlcnJvcik7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlSGlkZGVuRXJyb3IobmV1cm9uSW5kZXgpIHtcbiAgICAgICAgbGV0IHN1bUVycm9yID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5vdXRwdXROZXVyb25zLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgY29uc3QgbmV1cm9uID0gdGhpcy5vdXRwdXROZXVyb25zW2luZGV4XTtcbiAgICAgICAgICAgIHN1bUVycm9yICs9IG5ldXJvbi53ZWlnaHRzW25ldXJvbkluZGV4XSAqIG5ldXJvbi5lcnJvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlRXJyb3JEZXJpdmF0ZWQoc3VtRXJyb3IpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGNhbGN1bGF0ZUVycm9yRGVyaXZhdGVkKGZhY3RvckRlbHRhKSB7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBmYWN0b3JEZWx0YSAqIHRoaXMucHJpbWUoKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHByaW1lKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnN5bmFwdGljUHJvY2Vzc29yLmFjdGl2YXRpb25GdW5jdGlvbi5wcmltZSh0aGlzLnN5bmFwc2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RmxvYXQ2NEFycmF5fSBiZWZvcmVXZWlnaHRzXG4gICAgICogQHJldHVybnMge3RoaXN9XG4gICAgICovXG4gICAgc2V0QmVmb3JlV2VpZ2h0cyhiZWZvcmVXZWlnaHRzOiBGbG9hdDY0QXJyYXkpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5iZWZvcmVXZWlnaHRzID0gYmVmb3JlV2VpZ2h0cztcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7dGhpc31cbiAgICAgKi9cbiAgICBzZXRUaHJlc2hvbGQodGhyZXNob2xkOiBudW1iZXIpOiB0aGlzIHtcbiAgICAgICAgdGhpcy50aHJlc2hvbGQgPSB0aHJlc2hvbGQ7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgQWN0aXZhdGlvbkZ1bmN0aW9uVHlwZSB9IGZyb20gJy4vYWN0aXZhdGlvbi1mdW5jdGlvbnMvYWN0aXZhdGlvbi1mdW5jdGlvbic7XG5pbXBvcnQgeyBOZXVyb24gfSBmcm9tICcuL25ldXJvbic7XG5pbXBvcnQgeyBTeW5hcHRpY1Byb2Nlc3NvciB9IGZyb20gJy4vc3luYXB0aWMtcHJvY2Vzc29yJztcblxuZXhwb3J0IGNsYXNzIExheWVyIHtcbiAgICBwcml2YXRlIGxheWVyczogTmV1cm9uW11bXTtcbiAgICBwcml2YXRlIGFjdGl2YXRpb25GdW5jdGlvbjogQWN0aXZhdGlvbkZ1bmN0aW9uVHlwZTtcblxuICAgIHN5bmFwdGljUHJvY2Vzc29yOiBTeW5hcHRpY1Byb2Nlc3NvcjtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBhY3RpdmF0aW9uRnVuY3Rpb246IEFjdGl2YXRpb25GdW5jdGlvblR5cGUgPSBBY3RpdmF0aW9uRnVuY3Rpb25UeXBlLlNJR01PSURBTCxcbiAgICAgICAgbGVhcm5pbmdSYXRlOiBudW1iZXJcbiAgICApIHtcbiAgICAgICAgdGhpcy5sYXllcnMgPSBbXTtcbiAgICAgICAgdGhpcy5hY3RpdmF0aW9uRnVuY3Rpb24gPSBhY3RpdmF0aW9uRnVuY3Rpb247XG4gICAgICAgIHRoaXMuc3luYXB0aWNQcm9jZXNzb3IgPSBuZXcgU3luYXB0aWNQcm9jZXNzb3IoXG4gICAgICAgICAgICB0aGlzLmFjdGl2YXRpb25GdW5jdGlvbixcbiAgICAgICAgICAgIGxlYXJuaW5nUmF0ZVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBudW1iZXJOZXVyb25zXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBhZGQobnVtYmVyTmV1cm9uczogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5jcmVhdGUobnVtYmVyTmV1cm9ucyk7XG4gICAgICAgIGNvbnN0IGluZGV4TmV3TGF5ZXIgPSB0aGlzLmxheWVycy5wdXNoKGxheWVyKSAtIDE7XG4gICAgICAgIGNvbnN0IGJlZm9yZUxheWVyID0gdGhpcy5sYXllcnNbaW5kZXhOZXdMYXllciAtIDFdO1xuXG4gICAgICAgIGlmIChiZWZvcmVMYXllciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFwdW50YXIgY29uIGNhZGEgTmV1cm9uIGRlIGxhIG51ZXZhIGNhcGEgYSBsYSBhbnRlcmlvclxuICAgICAgICBsYXllci5mb3JFYWNoKChuZXVyb246IE5ldXJvbikgPT4ge1xuICAgICAgICAgICAgbmV1cm9uLmlucHV0TmV1cm9ucyA9IGJlZm9yZUxheWVyO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBcHVudGFyIGNvbiBjYWRhIG5ldXJvbmEgZGUgbGEgY2FwYSBhbnRlcmlvciBhIGxhIG51ZXZhIGNhcGFcbiAgICAgICAgYmVmb3JlTGF5ZXIuZm9yRWFjaCgobmV1cm9uOiBOZXVyb24pID0+IHtcbiAgICAgICAgICAgIG5ldXJvbi5vdXRwdXROZXVyb25zID0gbGF5ZXI7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGZvckVhY2goY2FsbGJhY2s6IChsYXllcjogTmV1cm9uW10sIGluZGV4PzogbnVtYmVyKSA9PiB2b2lkKSB7XG4gICAgICAgIGZvciAobGV0IGlkeCA9IDA7IGlkeCA8IHRoaXMubGF5ZXJzLmxlbmd0aDsgaWR4KyspIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHRoaXMubGF5ZXJzW2lkeF0sIGlkeCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaW5kZXhcbiAgICAgKiBAcmV0dXJucyB7TmV1cm9uW119XG4gICAgICovXG4gICAgZ2V0KGluZGV4OiBudW1iZXIpOiBOZXVyb25bXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxheWVyc1tpbmRleF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge05ldXJvbltdfVxuICAgICAqL1xuICAgIGdldExhc3QoKTogTmV1cm9uW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQodGhpcy5sYXllcnMubGVuZ3RoIC0gMSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gbnVtYmVyTmV1cm9uc1xuICAgICAqIEByZXR1cm5zIHtOZXVyb25bXX1cbiAgICAgKi9cbiAgICBwcml2YXRlIGNyZWF0ZShudW1iZXJOZXVyb25zOiBudW1iZXIpOiBOZXVyb25bXSB7XG4gICAgICAgIGNvbnN0IGxheWVyOiBOZXVyb25bXSA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyTmV1cm9uczsgaSsrKSB7XG4gICAgICAgICAgICBsYXllcltpXSA9IG5ldyBOZXVyb24odGhpcy5hY3RpdmF0aW9uRnVuY3Rpb24pO1xuICAgICAgICAgICAgbGF5ZXJbaV0uc3luYXB0aWNQcm9jZXNzb3IgPSB0aGlzLnN5bmFwdGljUHJvY2Vzc29yO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGxheWVyO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEFjdGl2YXRpb25GdW5jdGlvblR5cGUgfSBmcm9tICcuL2FjdGl2YXRpb24tZnVuY3Rpb25zL2FjdGl2YXRpb24tZnVuY3Rpb24nO1xuaW1wb3J0IHsgTGF5ZXIgfSBmcm9tICcuL2xheWVyJztcbmltcG9ydCB7IE5ldXJvbiB9IGZyb20gJy4vbmV1cm9uJztcblxuaW50ZXJmYWNlIE1vZGVsVHlwZSB7XG4gICAgbGF5ZXJzOiBudW1iZXJbXTtcbiAgICB0aHJlc2hvbGRzOiBudW1iZXJbXVtdO1xuICAgIHdlaWdodHM6IG51bWJlcltdW11bXTtcbn1cblxuaW50ZXJmYWNlIEJhY2twcm9wYWdhdGlvbkNvbmZpZyB7XG4gICAgZXBvY2hzOiBudW1iZXI7XG4gICAgYWN0aXZhdGlvbkZ1bmN0aW9uPzogQWN0aXZhdGlvbkZ1bmN0aW9uVHlwZTtcbiAgICBsZWFybmluZ1JhdGU/OiBudW1iZXI7XG4gICAgdmVyYm9zZT86IGJvb2xlYW47XG59XG5cbid1c2Ugc3RyaWN0JztcbmV4cG9ydCBjbGFzcyBCYWNrcHJvcGFnYXRpb24ge1xuICAgIGxheWVyczogTGF5ZXI7XG4gICAgZXBvY2hzOiBudW1iZXI7XG4gICAgYWN0aXZhdGlvbkZ1bmN0aW9uOiBBY3RpdmF0aW9uRnVuY3Rpb25UeXBlO1xuICAgIGVycm9yOiBudW1iZXI7XG4gICAgdmVyYm9zZTogYm9vbGVhbjtcblxuICAgIGhpc3Rvcnk6IGFueTtcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1dG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIGNvbmZpZzogQmFja3Byb3BhZ2F0aW9uQ29uZmlnID0ge1xuICAgICAgICAgICAgZXBvY2hzOiAxMDAwLFxuICAgICAgICAgICAgYWN0aXZhdGlvbkZ1bmN0aW9uOiBBY3RpdmF0aW9uRnVuY3Rpb25UeXBlLlNJR01PSURBTCxcbiAgICAgICAgICAgIGxlYXJuaW5nUmF0ZTogMC4zLFxuICAgICAgICAgICAgdmVyYm9zZTogZmFsc2VcbiAgICAgICAgfVxuICAgICkge1xuICAgICAgICB0aGlzLmVycm9yID0gMDtcbiAgICAgICAgdGhpcy5hY3RpdmF0aW9uRnVuY3Rpb24gPSBjb25maWcuYWN0aXZhdGlvbkZ1bmN0aW9uO1xuICAgICAgICB0aGlzLmxheWVycyA9IG5ldyBMYXllcih0aGlzLmFjdGl2YXRpb25GdW5jdGlvbiwgY29uZmlnLmxlYXJuaW5nUmF0ZSk7XG4gICAgICAgIHRoaXMuZXBvY2hzID0gY29uZmlnLmVwb2NocztcbiAgICAgICAgdGhpcy52ZXJib3NlID0gY29uZmlnLnZlcmJvc2U7XG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IHtsb3NzOiBbXX07XG4gICAgfVxuXG4gICAgbGVhcm4oZGF0YXNldDogQXJyYXk8eyBpbnB1dDogYW55OyBvdXRwdXQ6IG51bWJlciB9Pikge1xuICAgICAgICB0aGlzLmRhdGFzZXRJbnB1dFRvRmxvYXRBcnJheShkYXRhc2V0KTtcblxuICAgICAgICB0aGlzLnJ1bkVwb2NoKGRhdGFzZXQpO1xuICAgICAgICBsZXQgY291bnRlckVwb2NocyA9IDE7XG5cbiAgICAgICAgd2hpbGUgKGNvdW50ZXJFcG9jaHMgPD0gdGhpcy5lcG9jaHMpIHtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5sb3NzLnB1c2godGhpcy5lcnJvcik7XG5cbiAgICAgICAgICAgIGNvdW50ZXJFcG9jaHMrKztcblxuICAgICAgICAgICAgaWYgKHRoaXMudmVyYm9zZSAmJiBjb3VudGVyRXBvY2hzICUgMTAwMCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZXJyb3IsIGNvdW50ZXJFcG9jaHMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiAodGhpcy5lcnJvciA8IDAuMDAwMSkge1xuICAgICAgICAgICAgLy8gICAgIGJyZWFrO1xuICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICB0aGlzLnJ1bkVwb2NoKGRhdGFzZXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHJvY2VzcyhkYXRhKSB7XG4gICAgICAgIGxldCBvdXRwdXRzOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICBkYXRhID0gbmV3IEZsb2F0NjRBcnJheShkYXRhKTtcblxuICAgICAgICBpZiAodGhpcy52ZXJib3NlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubGF5ZXJzLmZvckVhY2goKGxheWVyOiBOZXVyb25bXSkgPT4ge1xuICAgICAgICAgICAgaWYgKG91dHB1dHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBuZXcgRmxvYXQ2NEFycmF5KG91dHB1dHMpO1xuICAgICAgICAgICAgICAgIG91dHB1dHMgPSBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5sYXllcnMuc3luYXB0aWNQcm9jZXNzb3Iuc2V0RGF0YShkYXRhKTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGxheWVyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ldXJvbiA9IGxheWVyW2luZGV4XTtcbiAgICAgICAgICAgICAgICBvdXRwdXRzW2luZGV4XSA9IG5ldXJvbi5wcm9jZXNzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLnZlcmJvc2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG91dHB1dHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG91dHB1dHM7XG4gICAgfVxuXG4gICAgYWRkTGF5ZXIobnVtYmVyTmV1cm9uczogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMubGF5ZXJzLmFkZChudW1iZXJOZXVyb25zKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3sgbGF5ZXJzOiBudW1iZXJbXTsgd2VpZ2h0czogbnVtYmVyW11bXSB9fSBtb2RlbFxuICAgICAqIEByZXR1cm5zIHt0aGlzfVxuICAgICAqL1xuICAgIGltcG9ydE1vZGVsKG1vZGVsOiBNb2RlbFR5cGUpOiB0aGlzIHtcbiAgICAgICAgbW9kZWwubGF5ZXJzLmZvckVhY2gobGF5ZXIgPT4ge1xuICAgICAgICAgICAgdGhpcy5hZGRMYXllcihsYXllcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1vZGVsLndlaWdodHMuZm9yRWFjaCgobGF5ZXJXZWlnaHRzLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sYXllcnMuZ2V0KGluZGV4KS5mb3JFYWNoKChuZXVyb246IE5ldXJvbiwgbmV1cm9uSW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBuZXVyb25cbiAgICAgICAgICAgICAgICAgICAgLnNldFdlaWdodHMobmV3IEZsb2F0NjRBcnJheShsYXllcldlaWdodHNbbmV1cm9uSW5kZXhdKSlcbiAgICAgICAgICAgICAgICAgICAgLnNldEJlZm9yZVdlaWdodHMobmV1cm9uLndlaWdodHMuc2xpY2UoKSlcbiAgICAgICAgICAgICAgICAgICAgLnNldFRocmVzaG9sZChtb2RlbC50aHJlc2hvbGRzW2luZGV4XVtuZXVyb25JbmRleF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtNb2RlbFR5cGV9XG4gICAgICovXG4gICAgZXhwb3J0TW9kZWwoKTogTW9kZWxUeXBlIHtcbiAgICAgICAgbGV0IG1vZGVsOiBNb2RlbFR5cGUgPSB7XG4gICAgICAgICAgICBsYXllcnM6IFtdLFxuICAgICAgICAgICAgdGhyZXNob2xkczogW10sXG4gICAgICAgICAgICB3ZWlnaHRzOiBbXVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMubGF5ZXJzLmZvckVhY2gobGF5ZXIgPT4ge1xuICAgICAgICAgICAgbW9kZWwubGF5ZXJzLnB1c2gobGF5ZXIubGVuZ3RoKTtcblxuICAgICAgICAgICAgY29uc3QgaW5kZXhMYXllclRocmVzaG9sZHMgPSBtb2RlbC50aHJlc2hvbGRzLnB1c2goW10pO1xuICAgICAgICAgICAgY29uc3QgaW5kZXhMYXllcldlaWdodHMgPSBtb2RlbC53ZWlnaHRzLnB1c2goW10pO1xuXG4gICAgICAgICAgICBsZXQgbGF5ZXJUaHJlc2hvbGRzID0gbW9kZWwudGhyZXNob2xkc1tpbmRleExheWVyVGhyZXNob2xkcyAtIDFdO1xuICAgICAgICAgICAgbGV0IGxheWVyV2VpZ2h0cyA9IG1vZGVsLndlaWdodHNbaW5kZXhMYXllcldlaWdodHMgLSAxXTtcblxuICAgICAgICAgICAgbGF5ZXIuZm9yRWFjaChuZXVyb24gPT4ge1xuICAgICAgICAgICAgICAgIGxheWVyV2VpZ2h0cy5wdXNoKEFycmF5LmZyb20obmV1cm9uLndlaWdodHMpKTtcbiAgICAgICAgICAgICAgICBsYXllclRocmVzaG9sZHMucHVzaChuZXVyb24udGhyZXNob2xkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gbW9kZWw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtBcnJheTx7IGlucHV0OiBhbnk7IG91dHB1dDogbnVtYmVyIH0+fSBkYXRhc2V0XG4gICAgICovXG4gICAgZGF0YXNldElucHV0VG9GbG9hdEFycmF5KGRhdGFzZXQ6IEFycmF5PHsgaW5wdXQ6IGFueTsgb3V0cHV0OiBudW1iZXIgfT4pIHtcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGRhdGFzZXQubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gZGF0YXNldFtpbmRleF07XG4gICAgICAgICAgICBkYXRhLmlucHV0ID0gbmV3IEZsb2F0NjRBcnJheShkYXRhLmlucHV0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheTx7IGlucHV0OiBGbG9hdDY0QXJyYXk7IG91dHB1dDogbnVtYmVyIH0+fSBkYXRhc2V0XG4gICAgICovXG4gICAgcHJpdmF0ZSBydW5FcG9jaChkYXRhc2V0OiBBcnJheTx7IGlucHV0OiBGbG9hdDY0QXJyYXk7IG91dHB1dDogbnVtYmVyIH0+KSB7XG4gICAgICAgIGZvciAobGV0IGRhdGFJZHggPSAwOyBkYXRhSWR4IDwgZGF0YXNldC5sZW5ndGg7IGRhdGFJZHgrKykge1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRhdGFzZXRbZGF0YUlkeF07XG5cbiAgICAgICAgICAgIHRoaXMuZm9yd2FyZHByb3BhZ2F0aW9uKGRhdGEpO1xuICAgICAgICAgICAgdGhpcy5iYWNrcHJvcGFnYXRpb24oZGF0YS5vdXRwdXQpO1xuXG4gICAgICAgICAgICB0aGlzLmxheWVycy5mb3JFYWNoKGxheWVyID0+IHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBuZXVyb25JZHggPSAwOyBuZXVyb25JZHggPCBsYXllci5sZW5ndGg7IG5ldXJvbklkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ldXJvbiA9IGxheWVyW25ldXJvbklkeF07XG4gICAgICAgICAgICAgICAgICAgIG5ldXJvbi5yZWNhbGN1bGF0ZVdlaWdodHMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB7IGlucHV0LCBvdXRwdXQgfVxuICAgICAqIEByZXR1cm5zXG4gICAgICovXG4gICAgcHJpdmF0ZSBmb3J3YXJkcHJvcGFnYXRpb24oeyBpbnB1dCB9OiBhbnkpIHtcbiAgICAgICAgbGV0IG91dHB1dHMgPSBbXTtcbiAgICAgICAgbGV0IGRhdGEgPSBuZXcgRmxvYXQ2NEFycmF5KGlucHV0KTtcblxuICAgICAgICB0aGlzLmxheWVycy5mb3JFYWNoKChsYXllcjogTmV1cm9uW10pID0+IHtcbiAgICAgICAgICAgIGlmIChvdXRwdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gbmV3IEZsb2F0NjRBcnJheShvdXRwdXRzKTtcbiAgICAgICAgICAgICAgICBvdXRwdXRzID0gW107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMubGF5ZXJzLnN5bmFwdGljUHJvY2Vzc29yLnNldERhdGEoZGF0YSk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBsYXllci5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXVyb24gPSBsYXllcltpbmRleF07XG4gICAgICAgICAgICAgICAgb3V0cHV0c1tpbmRleF0gPSBuZXVyb24ubGVhcm4oKS5vdXRwdXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gb3V0cHV0XG4gICAgICovXG4gICAgcHJpdmF0ZSBiYWNrcHJvcGFnYXRpb24ob3V0cHV0OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgbGFzdExheWVyID0gdGhpcy5sYXllcnMuZ2V0TGFzdCgpO1xuICAgICAgICBsZXQgc3VtRXJyb3JzID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbGFzdExheWVyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgY29uc3QgbmV1cm9uID0gbGFzdExheWVyW2luZGV4XTtcblxuICAgICAgICAgICAgbmV1cm9uLmNhbGN1bGF0ZUVycm9yT2ZPdXRwdXQob3V0cHV0KTtcbiAgICAgICAgICAgIG5ldXJvbi5iYWNrcHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgc3VtRXJyb3JzICs9IG5ldXJvbi5lcnJvciAqIG5ldXJvbi5lcnJvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZXJyb3IgPSBzdW1FcnJvcnMgLyAyO1xuICAgIH1cbn1cbiIsIi8qKlxuICogUmVjdGlmaWVkIExpbmVhciBVbml0IChSZUxVKVxuICovXG5leHBvcnQgbmFtZXNwYWNlIFJlTFUge1xuICAgIGV4cG9ydCBmdW5jdGlvbiBhY3RpdmF0aW9uKHN5bmFwc2UpIHtcbiAgICAgICAgcmV0dXJuIHN5bmFwc2UgPiAwID8gc3luYXBzZSA6IDA7XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHByaW1lKHN5bmFwc2UpIHtcbiAgICAgICAgcmV0dXJuIHN5bmFwc2U7XG4gICAgfVxufSIsImV4cG9ydCBuYW1lc3BhY2UgU2lnbW9pZGFsIHtcbiAgICBleHBvcnQgZnVuY3Rpb24gYWN0aXZhdGlvbihzeW5hcHNlKSB7XG4gICAgICAgIHJldHVybiAxIC8gKDEgKyBNYXRoLkUgKiogLXN5bmFwc2UpO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBwcmltZShzeW5hcHNlKSB7XG4gICAgICAgIGNvbnN0IGV4ID0gTWF0aC5FICoqIHN5bmFwc2U7XG5cbiAgICAgICAgcmV0dXJuIGV4IC8gKGV4ICsgMSkgKiogMjtcbiAgICB9XG59XG4iLCJleHBvcnQgbmFtZXNwYWNlIEh5cGVyYm9saWNUYW5nZW50IHtcbiAgICBleHBvcnQgZnVuY3Rpb24gYWN0aXZhdGlvbihzeW5hcHNlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnRhbmgoc3luYXBzZSk7XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHByaW1lKHN5bmFwc2UpIHtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gYWN0aXZhdGlvbihzeW5hcHNlKTtcblxuICAgICAgICByZXR1cm4gMS4wIC0gb3V0cHV0ICogb3V0cHV0O1xuICAgIH1cbn1cbiIsImV4cG9ydCBuYW1lc3BhY2UgQmluYXJ5IHtcbiAgICBleHBvcnQgZnVuY3Rpb24gYWN0aXZhdGlvbihzeW5hcHNlKSB7XG4gICAgICAgIHJldHVybiBzeW5hcHNlID49IDAgPyAxIDogMDtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBQZXJjZXB0cm9uIH0gZnJvbSAnLi9wZXJjZXB0cm9uJztcbmltcG9ydCB7IEJhY2twcm9wYWdhdGlvbiB9IGZyb20gJy4vYmFja3Byb3BhZ2F0aW9uJztcblxuZXhwb3J0IHsgUGVyY2VwdHJvbiwgQmFja3Byb3BhZ2F0aW9uIH07XG4iXSwic291cmNlUm9vdCI6IiJ9